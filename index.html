<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Miracle Canvas</title>
	<style type="text/css">
		*{
			padding: 0;
			margin: 0;
		}

		#container{
			width: 1000px;
			height: 615px;
			background-image: url(bg.jpg);

			margin: 0 auto;
		}
		#main{
			/*background-color: red;*/
		}
	</style>
</head>
<body>
	<div id="container">
		<canvas id="main" width="100px" height="100px"></canvas>
    </div>
	<script type="text/javascript">
		var canvas = document.getElementById('main');
		var container = document.getElementById('container');
		var width = container.offsetWidth;
		var height = container.offsetHeight;
		if(typeof canvas.getContext == 'function'){
			var context = canvas.getContext('2d');
		}

		canvas.setAttribute("width",width+"px");
		canvas.setAttribute("height",height+"px");

		//遮罩
		context.beginPath();
		context.fillStyle = 'rgba(0,0,0,0.7)';
		context.fillRect(0,0,width,height);

		var x1 = y1 = x2 = y2 = 0;
		var press = false;

		context.strokeStyle = "rgba(0,0,0,1)";

		//注意：监听canvas！
		canvas.addEventListener('mousedown',handler,false);
		canvas.addEventListener('mousemove',handler,false);
		canvas.addEventListener('mouseup',handler,false);

		function handler(ele){
			switch(ele.type){
				case 'mousedown':
				x1 = ele.clientX - canvas.offsetLeft;
				y1 = ele.clientY - canvas.offsetTop;
				clear(x1,y1,context);
				press = true;
				break;
				case 'mousemove':
				if(press){
					x1 = ele.clientX - canvas.offsetLeft;
					y1 = ele.clientY - canvas.offsetTop;
					console.log(canvas.offsetX);
					clear(x1,y1,context);
				}
				break;
				case 'mouseup':
				press = false;
				break;
			}
		}

		function clear(x,y,context){
			context.save();
			context.beginPath();
			context.arc(x,y,30,0,2*Math.PI);
			context.clip();
			context.clearRect(0,0,1000,615);
			context.restore();
		}
	</script>
</body>
</html>